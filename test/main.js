const mountdata = [
   {
      "name": "利尻山",
      "latitude": 45.1786111,
      "longitude": 141.2419444
   },
   {
      "name": "羅臼岳",
      "latitude": 44.0758333,
      "longitude": 145.1222222
   },
   {
      "name": "斜里岳",
      "latitude": 43.7655555,
      "longitude": 144.7177777
   },
   {
      "name": "阿寒岳",
      "latitude": 43.3866666,
      "longitude": 144.0088888
   },
   {
      "name": "大雪山",
      "latitude": 43.6636111,
      "longitude": 142.8541666
   },
   {
      "name": "トムラウシ山",
      "latitude": 43.5272222,
      "longitude": 142.8488888
   },
   {
      "name": "十勝岳",
      "latitude": 43.4180555,
      "longitude": 142.6863888
   },
   {
      "name": "幌尻岳",
      "latitude": 42.7194444,
      "longitude": 142.6827777
   },
   {
      "name": "後方羊蹄山",
      "latitude": 42.8266666,
      "longitude": 140.8113888
   },
   {
      "name": "岩木山",
      "latitude": 40.6558333,
      "longitude": 140.3030555
   },
   {
      "name": "八甲田山",
      "latitude": 40.6588888,
      "longitude": 140.8772222
   },
   {
      "name": "八幡平",
      "latitude": 39.9577777,
      "longitude": 140.8541666
   },
   {
      "name": "岩手山",
      "latitude": 39.8525,
      "longitude": 141.0011111
   },
   {
      "name": "早池峰山",
      "latitude": 39.5586111,
      "longitude": 141.4886111
   },
   {
      "name": "鳥海山",
      "latitude": 39.0991666,
      "longitude": 140.0488888
   },
   {
      "name": "月山",
      "latitude": 38.5488888,
      "longitude": 140.0269444
   },
   {
      "name": "朝日岳",
      "latitude": 38.2605555,
      "longitude": 139.9222222
   },
   {
      "name": "蔵王山",
      "latitude": 38.1436111,
      "longitude": 140.44
   },
   {
      "name": "飯豊山",
      "latitude": 37.8547222,
      "longitude": 139.7072222
   },
   {
      "name": "吾妻山",
      "latitude": 37.7383333,
      "longitude": 140.1408333
   },
   {
      "name": "安達太良山",
      "latitude": 37.6211111,
      "longitude": 140.2877777
   },
   {
      "name": "磐梯山",
      "latitude": 37.6008333,
      "longitude": 140.0722222
   },
   {
      "name": "駒ヶ岳",
      "latitude": 37.0475,
      "longitude": 139.3536111
   },
   {
      "name": "那須岳",
      "latitude": 37.1247222,
      "longitude": 139.9627777
   },
   {
      "name": "駒ヶ岳",
      "latitude": 37.1236111,
      "longitude": 139.0752777
   },
   {
      "name": "平ヶ岳",
      "latitude": 37.0019444,
      "longitude": 139.1708333
   },
   {
      "name": "巻機山",
      "latitude": 36.9786111,
      "longitude": 138.9641666
   },
   {
      "name": "燧ヶ岳",
      "latitude": 36.955,
      "longitude": 139.2852777
   },
   {
      "name": "至仏山",
      "latitude": 36.9036111,
      "longitude": 139.1733333
   },
   {
      "name": "谷川岳",
      "latitude": 36.8372222,
      "longitude": 138.93
   },
   {
      "name": "雨飾山",
      "latitude": 36.9019444,
      "longitude": 137.9625
   },
   {
      "name": "苗場山",
      "latitude": 36.8458333,
      "longitude": 138.6902777
   },
   {
      "name": "妙高山",
      "latitude": 36.8913888,
      "longitude": 138.1136111
   },
   {
      "name": "火打山",
      "latitude": 36.9227777,
      "longitude": 138.0680555
   },
   {
      "name": "高妻山",
      "latitude": 36.8,
      "longitude": 138.0519444
   },
   {
      "name": "男体山",
      "latitude": 36.765,
      "longitude": 139.4908333
   },
   {
      "name": "白根山",
      "latitude": 36.7986111,
      "longitude": 139.3758333
   },
   {
      "name": "皇海山",
      "latitude": 36.69,
      "longitude": 139.3369444
   },
   {
      "name": "武尊山",
      "latitude": 36.8052777,
      "longitude": 139.1325
   },
   {
      "name": "赤城山",
      "latitude": 36.5602777,
      "longitude": 139.1933333
   },
   {
      "name": "本白根山",
      "latitude": 36.6227777,
      "longitude": 138.5319444
   },
   {
      "name": "四阿山",
      "latitude": 36.5416666,
      "longitude": 138.4130555
   },
   {
      "name": "浅間山",
      "latitude": 36.4063888,
      "longitude": 138.5230555
   },
   {
      "name": "筑波山",
      "latitude": 36.2252777,
      "longitude": 140.1066666
   },
   {
      "name": "白馬岳",
      "latitude": 36.7586111,
      "longitude": 137.7586111
   },
   {
      "name": "五龍岳",
      "latitude": 36.6583333,
      "longitude": 137.7527777
   },
   {
      "name": "鹿島槍ヶ岳",
      "latitude": 36.6244444,
      "longitude": 137.7469444
   },
   {
      "name": "剱岳",
      "latitude": 36.6233333,
      "longitude": 137.6169444
   },
   {
      "name": "立山",
      "latitude": 36.5758333,
      "longitude": 137.6197222
   },
   {
      "name": "薬師岳",
      "latitude": 36.4688888,
      "longitude": 137.5447222
   },
   {
      "name": "黒部五郎岳",
      "latitude": 36.3925,
      "longitude": 137.54
   },
   {
      "name": "水晶岳",
      "latitude": 36.4263888,
      "longitude": 137.6027777
   },
   {
      "name": "鷲羽岳",
      "latitude": 36.4030555,
      "longitude": 137.6052777
   },
   {
      "name": "槍ヶ岳",
      "latitude": 36.3419444,
      "longitude": 137.6475
   },
   {
      "name": "穂高岳",
      "latitude": 36.2891666,
      "longitude": 137.6480555
   },
   {
      "name": "常念岳",
      "latitude": 36.3255555,
      "longitude": 137.7275
   },
   {
      "name": "笠ヶ岳",
      "latitude": 36.3155555,
      "longitude": 137.5502777
   },
   {
      "name": "焼岳",
      "latitude": 36.2269444,
      "longitude": 137.5869444
   },
   {
      "name": "乗鞍岳",
      "latitude": 36.1063888,
      "longitude": 137.5536111
   },
   {
      "name": "御嶽山",
      "latitude": 35.8927777,
      "longitude": 137.4802777
   },
   {
      "name": "美ヶ原",
      "latitude": 36.2258333,
      "longitude": 138.1075
   },
   {
      "name": "霧ヶ峰",
      "latitude": 36.1030555,
      "longitude": 138.1966666
   },
   {
      "name": "蓼科山",
      "latitude": 36.1036111,
      "longitude": 138.295
   },
   {
      "name": "八ヶ岳",
      "latitude": 35.9708333,
      "longitude": 138.37
   },
   {
      "name": "両神山",
      "latitude": 36.0233333,
      "longitude": 138.8413888
   },
   {
      "name": "雲取山",
      "latitude": 35.8555555,
      "longitude": 138.9438888
   },
   {
      "name": "甲武信ヶ岳",
      "latitude": 35.9088888,
      "longitude": 138.7288888
   },
   {
      "name": "金峰山",
      "latitude": 35.8713888,
      "longitude": 138.6252777
   },
   {
      "name": "瑞牆山",
      "latitude": 35.8933333,
      "longitude": 138.5919444
   },
   {
      "name": "大菩薩嶺",
      "latitude": 35.7488888,
      "longitude": 138.8455555
   },
   {
      "name": "丹沢山",
      "latitude": 35.4863888,
      "longitude": 139.1388888
   },
   {
      "name": "富士山",
      "latitude": 35.3608333,
      "longitude": 138.7275
   },
   {
      "name": "天城山",
      "latitude": 34.8627777,
      "longitude": 139.0016666
   },
   {
      "name": "駒ヶ岳",
      "latitude": 35.7894444,
      "longitude": 137.8044444
   },
   {
      "name": "空木岳",
      "latitude": 35.7188888,
      "longitude": 137.8172222
   },
   {
      "name": "恵那山",
      "latitude": 35.4436111,
      "longitude": 137.5972222
   },
   {
      "name": "駒ヶ岳",
      "latitude": 35.7580555,
      "longitude": 138.2366666
   },
   {
      "name": "仙丈ヶ岳",
      "latitude": 35.72,
      "longitude": 138.1836111
   },
   {
      "name": "鳳凰山",
      "latitude": 35.7016666,
      "longitude": 138.3047222
   },
   {
      "name": "北岳",
      "latitude": 35.6744444,
      "longitude": 138.2388888
   },
   {
      "name": "間ノ岳",
      "latitude": 35.6461111,
      "longitude": 138.2283333
   },
   {
      "name": "塩見岳",
      "latitude": 35.5738888,
      "longitude": 138.1830555
   },
   {
      "name": "悪沢岳",
      "latitude": 35.5008333,
      "longitude": 138.1825
   },
   {
      "name": "赤石岳",
      "latitude": 35.4611111,
      "longitude": 138.1572222
   },
   {
      "name": "聖岳",
      "latitude": 35.4227777,
      "longitude": 138.1397222
   },
   {
      "name": "光岳",
      "latitude": 35.3380555,
      "longitude": 138.0838888
   },
   {
      "name": "白山",
      "latitude": 36.155,
      "longitude": 136.7713888
   },
   {
      "name": "荒島岳",
      "latitude": 35.9341666,
      "longitude": 136.6013888
   },
   {
      "name": "伊吹山",
      "latitude": 35.4177777,
      "longitude": 136.4063888
   },
   {
      "name": "大台ヶ原山",
      "latitude": 34.1852777,
      "longitude": 136.1091666
   },
   {
      "name": "大峰山",
      "latitude": 34.1736111,
      "longitude": 135.9075
   },
   {
      "name": "大山",
      "latitude": 35.3711111,
      "longitude": 133.5461111
   },
   {
      "name": "剣山",
      "latitude": 33.8536111,
      "longitude": 134.0941666
   },
   {
      "name": "石鎚山",
      "latitude": 33.7677777,
      "longitude": 133.115
   },
   {
      "name": "くじゅう連山",
      "latitude": 33.0822222,
      "longitude": 131.2408333
   },
   {
      "name": "祖母山",
      "latitude": 32.8280555,
      "longitude": 131.3469444
   },
   {
      "name": "阿蘇山",
      "latitude": 32.8844444,
      "longitude": 131.1038888
   },
   {
      "name": "霧島山",
      "latitude": 31.9341666,
      "longitude": 130.8616666
   },
   {
      "name": "開聞岳",
      "latitude": 31.18,
      "longitude": 130.5283333
   },
   {
      "name": "宮之浦岳",
      "latitude": 30.3361111,
      "longitude": 130.5041666
   }
];

const maxdist = 120.0; //見える最大距離
const mount = 100;  //山の数
const radius = 6378.1; //km
const mltp = 2;
var lists = [];

var alpha = 0, beta = 0, gamma = 0;             // ジャイロの値を入れる変数を3個用意

const dis_size = deviceInchSize();

var canvas, ctx;

window.addEventListener("deviceorientation", (dat) => {
   alpha = dat.alpha;  // z軸（表裏）まわりの回転の角度（反時計回りがプラス）
   beta = dat.beta;   // x軸（左右）まわりの回転の角度（引き起こすとプラス）
   gamma = dat.gamma;  // y軸（上下）まわりの回転の角度（右に傾けるとプラス）


   text = alpha;
   document.getElementById("rotate").innerHTML = text;

});


function main() {
   document.getElementById("inch").innerHTML = "横: " + dis_size.widthInch + " 縦: " + dis_size.heightInch;
   navigator.geolocation.watchPosition(getinfo);
}

var getinfo = function getinfo(position) {

   lists = [];

   var geo_text = "緯度:" + position.coords.latitude;
   geo_text += " 経度:" + position.coords.longitude;
   geo_text += " 高度:" + position.coords.altitude;
   geo_text += " 位置精度:" + position.coords.accuracy;  //誤差　周囲hoge m みたいな感じ


   const now_lat = position.coords.latitude * Math.PI / 180.0;
   const now_lon = position.coords.longitude * Math.PI / 180.0;




   document.getElementById("content").innerHTML = geo_text;

   for (var i = 0; i < mount; i++) {
      const dif_lon = Math.abs(now_lon * 180.0 / Math.PI - mountdata[i].longitude) * Math.PI / 180.0;
      var res = Math.acos(Math.sin(now_lat) * Math.sin(mountdata[i].latitude * Math.PI / 180.0) + Math.cos(now_lat) * Math.cos(mountdata[i].latitude * Math.PI / 180.0) * Math.cos(dif_lon));
      //console.log(radius * res +" "+ mountdata[i].name);
      if (res * radius < maxdist) {
         lists.push(res * radius + " " + mountdata[i].name);
      }
   }
   console.log(lists);

}



function windowWidthHeight() {
   var ratio;
   window.devicePixelRatio ? ratio = window.devicePixelRatio : ratio = 2;
   return {
      windowWidth: window.innerWidth,
      windowHeight: window.innerHeight,
      devicePixelRatio: ratio
   };
}
function deviceDpi() {
   var POINTDPI = 96,
      ratio = windowWidthHeight().devicePixelRatio,
      width = windowWidthHeight().windowWidth,
      coefficient,
      logicalDpi,
      estimatedActualDpi = logicalDpi * ratio;
   ratio < 2 ? coefficient = -ratio : coefficient = ratio,
      logicalDpi = (devicePixelRatio === 1) ?
         (POINTDPI + Math.sqrt(Math.sqrt(windowWidthHeight().windowWidth)) * coefficient) :
         (POINTDPI + (POINTDPI / ratio) + Math.sqrt(Math.sqrt(width)) * coefficient);
   return {
      logicalDpi: logicalDpi,
      estimatedActualDpi: estimatedActualDpi
   };
}
function deviceInchSize() {
   var dpi = deviceDpi().logicalDpi,
      width = windowWidthHeight().windowWidth,
      height = windowWidthHeight().windowHeight;
   widthInch = width / dpi,
      heightInch = height / dpi,
      diagonalInch = Math.sqrt(Math.pow(widthInch, 2) + Math.pow(heightInch, 2));

   return {
      widthInch: widthInch,
      heightInch: heightInch,
      diagonalInch: diagonalInch
   }
}

var k = 0;
var cnvs = function draw() {
   canvas = document.getElementById('sample');
   ctx = canvas.getContext('2d');
   canvas.width = window.screen.width * 2;
   //console.log(canvas.width);

   ctx.fillStyle = '#000000';
   ctx.strokeStyle = 'red';

   var diff = (alpha - Math.floor(alpha)) * Math.PI / 180;

   var sabun = Math.sin(diff) * 60 / dis_size.widthInch * canvas.width;
   var target = Math.ceil(alpha);
   var onedeg = Math.sin(Math.PI / 180) * dis_size.widthInch * canvas.width;
   for (var i = -10; i <= 10; i += 2) {
      ctx.moveTo(-sabun + i * onedeg + canvas.width / 2, 50);
      ctx.lineTo(-sabun + i * onedeg + canvas.width / 2, 300);
      ctx.fillText((target + i) % 360, -sabun + i * onedeg + canvas.width / 2, 30, 200);
   }

   /*for (var i = 0; i < lists.length; i++) {
      ctx.moveTo(-sabun + i * onedeg, 50);
      ctx.lineTo(-sabun + i * onedeg, 300);
      //ctx.fillText(lists[i].name, -sabun + i * onedeg, 10, 200);
   }
   */

   //ctx.fillText(diff + " " + sabun, 100, 100, 200);
   ctx.fill();
   ctx.stroke();


}




window.onload = function () {
   main();
};

setInterval(cnvs, 100);